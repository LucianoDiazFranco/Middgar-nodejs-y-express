<main>
    <section class="banner">
        <img src="/img/Manada.png" alt="Logo Lobatos y Lobeznas">
        <h1>El mundo de la fantas칤a y los juegos te est치n llamando</h1>
        <h2>Lobatos y Lobeznas: 7 a 11 a침os</h2>
    </section>
    
    <section class="content">
        <div class="activities">
            <input type="text" placeholder="Buscar...">
            <div class="buttons">
                <!-- Bot칩n reemplazado por la funcionalidad de cargar PDF -->
                <label for="pdfUploader" class="upload-label">游늯 Cargar PDFs</label>
                <input type="file" id="pdfUploader" name="pdfs" accept="application/pdf" multiple />
                
                <button>游논</button>
                <button>
                    <a href="https://docs.google.com/forms/d/e/1FAIpQLSfBPkCSDpTEHuunePnQk79gbh8LSsgpihL8QsdL7hnZh9vqug/viewform?usp=sf_link" target="_blank">
                        Agregar Planilla de Riesgo
                    </a>
                </button>
            </div>
           

            <h3>Archivos PDF</h3>
            <ul id="pdf-list"></ul> <!-- Aqu칤 se mostrar치n los PDFs -->
        </div>
    </section>
</main>

<!-- Formulario oculto para subir archivos -->
<form id="uploadForm" enctype="multipart/form-data" style="display: none;">
    <input type="file" id="pdfUploaderHidden" name="pdfs" accept="application/pdf" multiple />
</form>

<div id="status"></div>

<script>
    const form = document.getElementById("uploadForm");
    const pdfUploader = document.getElementById("pdfUploader");
    const pdfList = document.getElementById("pdf-list");

    // Funci칩n para cargar los archivos PDF desde el servido
    async function loadPDFs() {
        try {
            const response = await fetch('/list-pdfs');
            const pdfFiles = await response.json();
            
            pdfList.innerHTML = ''; // Limpiar la lista antes de cargar nuevos elementos

            // A침adir cada archivo PDF a la lista
            pdfFiles.forEach(file => {
                const li = document.createElement('li');
                const link = document.createElement('a');
                link.href = `/uploads/${file}`;
                link.textContent = file;
                link.target = '_blank'; // Abrir en nueva pesta침a
                li.appendChild(link);
                pdfList.appendChild(li);
            });
        } catch (error) {
            console.error('Error al cargar los archivos PDF:', error);
        }
    }

    // Cargar PDFs cuando se carga la p치gina
    window.addEventListener('load', loadPDFs);

    pdfUploader.addEventListener("change", async function () {
        const formData = new FormData();

        // A침adir cada archivo al FormData
        for (let i = 0; i < pdfUploader.files.length; i++) {
            formData.append("pdfs", pdfUploader.files[i]);
        }

        // Enviar los archivos al servidor
        const response = await fetch("/upload", {
            method: "POST",
            body: formData
        });

        const result = await response.text();
        document.getElementById("status").innerText = result;

        // Recargar la lista de PDFs despu칠s de subir nuevos archivos
        loadPDFs();
    });
</script>
